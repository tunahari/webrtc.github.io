# üì° H∆∞·ªõng d·∫´n ch·∫°y test WebRTC local v·ªõi Docker + Coturn

## ‚öôÔ∏è Y√™u c·∫ßu
- C√†i ƒë·∫∑t [Node.js](https://nodejs.org/)
- Ch·∫°y `npm install` trong th∆∞ m·ª•c `server/`

---

## üß™ B∆∞·ªõc 1: T√¨m IP n·ªôi b·ªô (IP d√πng ƒë·ªÉ c·∫•u h√¨nh TURN server)

### Tr√™n Windows:
- bash(cmd): `ipconfig`

- T√¨m `IPv4 Address`, v√≠ d·ª•: `192.168.2.15`

### Tr√™n Linux:
- bash(ubuntu): `ip a`

- T√¨m `inet` trong ph·∫ßn ch·ª©a `BROADCAST, MULTICAST`, v√≠ d·ª•: `172.18.254.133/20`
- Ip c·∫ßn t√¨m l√†: `172.18.254.133`
---------------------------------------------

## üõ†Ô∏è B∆∞·ªõc 2: C·∫•u h√¨nh Coturn

- M·ªü file: `.env`
- Thay ƒë·ªïi
     `ALLOWED_PEER_IP={IP n·ªôi b·ªô}`
    v√≠ d·ª•: `ALLOWED_PEER_IP=192.168.x.x`  # (ho·∫∑c IP n·ªôi b·ªô b·∫°n v·ª´a t√¨m)

> ‚ö†Ô∏è N·∫øu ch·ªâ test local, gi·ªØ nguy√™n `EXTERNAL_IP` v√† `RELAY_IP` l√† `127.0.0.1`

- ‚ö†Ô∏è C·ªïng c·ªßa server v√† c·ªïng c·ªßa Turn l√† 2 c·ªïng kh√°c nhau
- ‚ö†Ô∏è Thay ƒë·ªïi c·ªïng kh√°c n·∫øu c·ªïng b·ªã ch·∫∑n tr√™n thi·∫øt b·ªã
---------------------------------------------

## üöÄ B∆∞·ªõc 3: Kh·ªüi ch·∫°y server.
- Kh·ªüi ch·∫°y Docker Desktop (Aplication)
- Build m·ªõi compose docker
- bash: `docker compose up -d --build`

N·∫øu th√†nh c√¥ng, terminal s·∫Ω b√°o:
```
‚úî Container coturn Started
‚úî Container server Started
```
- C·∫£ 2 container ph·∫£i ·ªü tr·∫°ng th√°i Started 

---------------------------------------------

## üß™ B∆∞·ªõc 4: Ki·ªÉm tra TURN server ho·∫°t ƒë·ªông

- Truy c·∫≠p: [Trickle ICE](https://webrtc.github.io/samples/src/content/peerconnection/trickle-ice/) 

Nh·∫≠p th√¥ng tin:

STUN or TURN URI: turn:<IP n·ªôi b·ªô>:<TURN_PORT>
TURN username: <TURN_USER>
TURN password: <TURN_PASSWORD>

üëâ Th√¥ng tin n√†y l·∫•y trong `.env`

- Nh·∫•n **Gather candidates**  
‚úÖ N·∫øu b·∫°n th·∫•y d√≤ng `relayProtocol` tr·∫£ v·ªÅ: `udp` ho·∫∑c `tcp` th√¨ TURN ho·∫°t ƒë·ªông th√†nh c√¥ng.


---------------------------------------------

## üé¨ B∆∞·ªõc 5: Ch·∫°y th·ª≠ giao di·ªán

- M·ªü `public/index.html` trong tr√¨nh duy·ªát v√† hi·ªÉn th·ªã `K·∫øt n·ªëi ƒë·∫øn m√°y ch·ªß th√†nh c√¥ng!`
- M·ªü DevTools (F12) ‚Üí tab Console  ‚Üí  `ICE servers ƒë∆∞·ª£c l·∫•y th√†nh c√¥ng:`
- Ki·ªÉm tra xem ICE server tr·∫£ v·ªÅ ƒë√∫ng TURN ch∆∞a
- N·∫øu tr·∫£ v·ªÅ turn d·ª± ph√≤ng th√¨ ph·∫£i xem l·∫°i c·∫•u h√¨nh turn.

---------------------------------------------

# ‚òÅÔ∏è H∆∞·ªõng d·∫´n tri·ªÉn khai WebRTC tr√™n VPS (Public IP)

## üåç B∆∞·ªõc 1: L·∫•y Public IP c·ªßa VPS

Truy c·∫≠p: [whatismyip.com](https://www.whatismyip.com/) v√† coppy: My Public IPv4

V√≠ d·ª•:  My Public IPv4: 104.28.160.165

---------------------------------------------

## üõ†Ô∏è B∆∞·ªõc 2: S·ª≠a file `.env`

Thay th·∫ø to√†n b·ªô EXTERNAL_IP, RELAY_IP v√† ALLOWED_PEER_IP b·∫±ng Public IPv4 v·ª´a t√¨m ƒë∆∞·ª£c
```conf (v√≠ d·ª•)
EXTERNAL_IP=104.28.160.165
RELAY_IP=104.28.160.165
ALLOWED_PEER_IP=104.28.160.165
```

> ‚ö†Ô∏è ƒê√¢y l√† IP Public th·∫≠t t·ª´ VPS
> ‚ö†Ô∏è VPS th∆∞·ªùng s·∫Ω m·ªü t·∫•t c·∫£ c√°c c·ªïng n√™n kh√¥ng c·∫ßn thay ƒë·ªïi `SERVER_PORT` `SERVER_PORT` trong .env
---------------------------------------------

## B∆∞·ªõc 3: üöÄ C√°c b∆∞·ªõc c√≤n l·∫°i:
Th·ª±c hi·ªán **gi·ªëng nh∆∞ h∆∞·ªõng d·∫´n local**, ch·ªâ thay IP l√† IP public VPS.
